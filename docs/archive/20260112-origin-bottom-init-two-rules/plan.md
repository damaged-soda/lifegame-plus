# 坐标系改为左下原点 + 初始化单点 + 两条扩展规则（Plan）

## 0. 背景与目标（简短即可）
- 背景：
  - 当前实现中，棋盘数组/渲染默认将 `y=0` 视为画面顶部行。
  - 初始化盘面为 A/B/C 三组较大的预设种子（竖线/横线/glider）。
  - 右侧原子规则列表包含多条方向规则。
- 目标：
  1) 坐标系与方向语义对齐：左下角为原点（`x=0,y=0` 在左下），`y` 向上增加；“上/下”方向与画面直觉一致。
  2) 初始化规则修改：最底层（`y=0`）随机一个位置，A/B/C 各放置 1 个点（允许同格叠加）。
     - 仍保持“可复现”：同 seed + 同规则配置 + 同操作序列 → 结果一致。
  3) 原子规则精简：只保留两类出生规则（死亡规则为空，默认存活）：
     - 横向扩展：左右对称；内部拆为两个方向子规则（左/右）以实现“两侧都活时概率更高”，但 UI 以同一条规则呈现并共用同一个概率 `p`。
     - 纵向扩展：只允许向上（由下方支撑生成）。
- 非目标：
  - 不新增坐标轴/刻度显示（目前画面不展示数值坐标）
  - 不恢复/新增画笔编辑能力
  - 不引入跨类型影响（A/B/C 仍只看同类型邻居独立演化）

## 1. 影响范围（必须）
- 影响的 repo（来自 docmap，可多项）：lifegame-plus
- 影响的模块/目录/文件（按 repo 分组列出即可）：
  - repo: lifegame-plus
    - `src/lifegame-plus/engine/lifegame.js`
      - 调整 `y` 方向：将内部遍历与邻居采样改为符合“`y` 向上增加”的语义（`N = y+1`，`S = y-1`）。
      - 兼容边界策略：左右环绕、上下不环绕保持不变。
    - `src/lifegame-plus/web/main.js`
      - 初始化盘面：改为 A/B/C 在 `y=0` 的单点随机初始化（seeded）。
      - 规则集与原子规则：替换为“横向扩展（左右）/纵向扩展（向上）”，死亡规则为空。
      - 渲染：Canvas 采用 y 轴翻转以匹配“`y=0` 在底部”的视觉语义。
      - 概率：横向扩展左右两侧命中时按“每条都抽”触发两次概率抽样（概率提升）。
    - `src/lifegame-plus/web/style.css`（如需）
      - 规则卡片 UI 若需要展示“横向扩展（左右子规则）”的分组/说明则补充样式。
- 外部可见变化（如适用：API/CLI/配置/数据格式）：
  - UI 行为变化：初始化种子与规则列表变化；画面 `y` 方向语义变化（上/下与画面一致）。

## 2. 方案与改动点（必须）
说明：实现将按批次推进；每批次写入前需先列出本批次改动文件/影响并征求确认。

### 2.1 坐标系与渲染（左下原点）
- 统一约定：`x` 向右增加；`y` 向上增加；左下角为 `(0,0)`。
- 引擎（`engine/lifegame.js`）：
  - 邻居方向定义不变（N/NE/E/SE/S/SW/W/NW），但其对应的 `(dx,dy)` 采用 `y` 向上语义：
    - N：`(0,+1)`，S：`(0,-1)`，其余类推。
  - 保持边界：X wrap；Y 越界视为空。
- Web 渲染（`web/main.js`）：
  - Canvas 原点仍在左上，但渲染时把内部 `y` 映射到画面：`screenY = (height - 1 - y)`，从而使内部 `y=0` 显示在最底部。

### 2.2 初始化（底层单点）
- 页面加载 / seed 变更 / 重试：
  - 使用同一个 seeded PRNG 生成随机 `x`（0..99），固定 `y=0`。
  - 在 `(x,0)` 放置 A 点；在 `(x,0)` 放置 B 点；在 `(x,0)` 放置 C 点（三次抽样独立；允许同格叠加）。

### 2.3 两类原子出生规则（死亡规则为空）
- 死亡规则：空列表（默认存活语义保持不变）。
- 纵向扩展（向上）：
  - 空格在下一步出生，当且仅当其“下方（S）”存在同类型活元胞。
  - 对应方向规则：`mustAliveMask = S`。
- 横向扩展（左右对称，概率叠加）：
  - 采用两个方向子规则：
    - 左扩展：`mustAliveMask = W`
    - 右扩展：`mustAliveMask = E`
  - UI 层表现为同一条“横向扩展”规则，并共享一个概率 `p`（默认 100%）。
  - 概率语义：
    - 若仅一侧命中：出生概率为 `p`
    - 若两侧都命中：会抽样两次（“每条都抽”），出生概率为 `1 - (1 - p)^2`

## 3. 自测与验收口径（必须，可执行）
- 本地自测步骤（命令/操作）：
  1) `python3 -m http.server 8000`
  2) 打开 `http://127.0.0.1:8000/src/lifegame-plus/web/`
  3) 页面加载后应出现 A/B/C 三个单点，且都在最底行（`y=0`）
  4) 仅启用“纵向扩展（向上）”，`p=100%`，点击 `播放`：应看到从底部向上增长（不会向下增长）
  5) 仅启用“横向扩展”，`p=100%`，点击 `播放`：应看到从底部单点向左右扩散（左右环绕）
  6) 可复现：固定 seed，重复“重试/改 seed”到同一 seed 后，初始化三点位置应一致
- 关键用例清单：
  - 坐标系：规则卡片中的“上/下”与画面方向一致；`y=0` 的点显示在最底部
  - 横向概率叠加：两侧都命中时比单侧更容易出生（`1-(1-p)^2`）
  - 仅向上：纵向扩展不会向下生成（Y 越界视为空）
  - 默认存活：死亡规则为空时，已有活元胞不会自行消失
  - 暂停约束：播放中禁用规则面板与概率调整
- 通过标准：
  - 初始化符合“底层单点 A/B/C”
  - 原子规则列表仅包含横向扩展与纵向扩展（向上），死亡规则为空
  - 坐标系语义与画面一致（左下为 `(0,0)`，`y` 向上）
  - 横向两侧命中时概率提升成立
  - 可复现性保持（seed 生效 + 重试重置盘面）

### 3.1 自测记录（实际执行）
- `node --check src/lifegame-plus/engine/lifegame.js`：通过
- `node --check src/lifegame-plus/web/main.js`：通过
- 引擎规则验证（Node 脚本）：
  - 初始 A 点在 `y=0`（底层）时，`mustAliveMask=S` 可在 `y=1` 出生（向上生长）
  - `mustAliveMask=W/E` 可在底层左右出生（左右环绕保持）
- 用户验收：通过（允许更新 SOT 并归档）

交付摘要口径（固定）：实现完成后，必须输出交付摘要，包含：
- 实际改动清单（按 repo 列出关键文件/模块）
- 自测步骤与结果
- 对照本节“通过标准”的逐条结论
- 已知风险/未决事项（如有必须列出）

约束：用户验收通过前，不更新 SOT，不归档 WIP。

## 4. SOT 更新清单（必须）
用户验收通过后，要把“最终事实”沉淀到 SOT：

- `docs/sot/overview.md`：更新初始化与规则列表描述（底层单点 + 两类扩展规则）
- `docs/sot/architecture.md`：补充坐标系约定（左下原点、y 向上）与渲染 y 翻转；更新初始化种子描述

## 5. 完成后归档动作（固定）
实现完成并完成基本自测后：
1) 输出交付摘要并请求用户验收
2) 用户验收通过后，按第 4 节更新 SOT
3) 更新第 6 节检查单（必须全勾）
4) 将整个目录从 `docs/wip/20260112-origin-bottom-init-two-rules/` 移动到 `docs/archive/20260112-origin-bottom-init-two-rules/`

## 6. WIP 检查单（必须全勾才能归档）
- [x] plan.md 已确认（PLAN 闸门已通过）
- [x] 代码改动已完成（IMPLEMENT 完成）
- [x] 基本自测已完成（记录命令/步骤与结果）
- [x] 已输出交付摘要并且用户验收通过（VERIFY 闸门已通过）
- [x] SOT 已更新（`docs/sot/overview.md`、`docs/sot/architecture.md`）
- [x] 已归档：wip → archive（目录已移动）
