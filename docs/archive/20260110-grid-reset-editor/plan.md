# Reset 白板 + 鼠标编辑棋盘 技术变更计划（Plan）

## 0. 背景与目标（简短即可）
- 背景：目前棋盘初始状态固定为 glider，缺少一个“从白板开始自己画”的入口，不利于后续探索不同规则/结构。
- 目标：
  - 新增 `Reset` 按钮：点击后清空棋盘为白板（全死），并自动进入暂停态（如果正在播放则先暂停）。
  - 暂停态支持鼠标编辑棋盘：
    - 单击某格：黑/白切换
    - 按住拖动：连续绘制（以首次落点决定本次拖动的“目标状态”：画黑或擦白）
  - 行为不变量：
    - `Reset` 只影响棋盘，不重置当前规则（`B.../S...`）与 `Speed`
    - 规则面板仍保持“播放中禁用、暂停可编辑”的约束不变
- 非目标：
  - 暂不做触屏手势优化、多指缩放等
  - 暂不做导入/导出图案、保存到 localStorage
  - 暂不做网格尺寸调整（仍固定 100×100）

## 1. 影响范围（必须）
- 影响的 repo（来自 docmap，可多项）：lifegame-plus
- 影响的模块/目录/文件（按 repo 分组列出即可）：
  - `src/lifegame-plus/web/index.html`：新增 `Reset` 按钮（与 Play/Pause、Speed 同区域）
  - `src/lifegame-plus/web/main.js`：新增清空网格逻辑；新增 canvas 鼠标事件处理与“拖动绘制”状态机
  - （可选）`src/lifegame-plus/web/style.css`：按钮样式与布局微调
- 外部可见变化：
  - 左侧控制区新增 `Reset`
  - 暂停时可通过鼠标直接编辑棋盘；播放时不响应编辑（避免误操作）

## 2. 方案与改动点（必须）
说明：实现将按批次推进；每批次写入前需先列出本批次改动文件/影响并征求确认。

- repo: lifegame-plus
  - 改动点：
    - UI：
      - 新增 `Reset` 按钮（点击清空为白板）
      - 鼠标悬停 canvas 时可编辑（仅暂停态）
    - 交互逻辑（`web/main.js`）：
      - `resetGrid()`：把当前 `grid` 置为全 0（白板），并触发一次 `render(grid)`
      - `Reset` 点击：
        - 若正在播放：先 `Pause`
        - 再执行 `resetGrid()`（不改 speed、rule）
      - 暂停态 canvas 编辑：
        - 单击：对命中 cell 执行 toggle（0↔1）
        - 拖动：`pointerdown` 记录“本次拖动目标状态”：
          - 如果按下时 cell 为白：目标=画黑（1）
          - 如果按下时 cell 为黑：目标=擦白（0）
        - `pointermove`（按下状态下）：对经过的 cell 设置为目标状态
        - 释放/离开：结束本次拖动
        - 为性能与稳定：
          - 用 canvas 的 bounding rect 将鼠标坐标映射到 cell（0..99）
          - 使用 `Set`/最后一个 cell index 去重，避免同一格重复写入与重复 render
          - 每次输入事件后仅在发生实际变化时 `render(grid)`
  - 新增/修改的接口或数据结构：无（沿用现有 `grid` 数据结构）
  - 关键逻辑说明：
    - 编辑约束：播放中不允许编辑（直接 return），以避免边跑边改导致体验混乱
    - 与规则面板不冲突：规则面板依旧用 fieldset disabled 控制；编辑逻辑单独基于“是否 playing”判断

## 3. 自测与验收口径（必须，可执行）
- 本地自测步骤：
  1. 根目录：`python3 -m http.server 8000`
  2. 打开：`http://127.0.0.1:8000/src/lifegame-plus/web/`
  3. 点击 `Reset`：棋盘立即清空为白板；若原本在播放则自动变为暂停（按钮文字为 `Play`）
  4. 暂停时：
     - 单击任意格：该格黑/白切换
     - 按住拖动：连续画黑（或擦白，取决于首次落点）
  5. 点击 `Play`：按当前规则继续演进；再次 `Pause` 后可继续编辑
  6. 切换 `Speed`、切换规则：确认 `Reset` 不会重置这些设置
- 关键用例清单：
  - `Reset` 清空棋盘且不改变规则/速度
  - `Reset` 会强制进入暂停态
  - 暂停态单击可 toggle
  - 暂停态拖动可连续画/擦（同一拖动保持同一目标状态）
  - 播放态不响应鼠标编辑
  - 现有 Play/Pause、Speed、规则面板行为不回归
- 通过标准：
  - 用户可以从白板开始通过鼠标编辑构造初始图案
  - `Reset` 行为符合“清空 + 自动暂停 + 不重置规则/速度”

## 4. SOT 更新清单（必须）
用户验收通过后更新：
- `docs/sot/overview.md`：补充 `Reset` 与“暂停可编辑棋盘”的能力与使用方式
- `docs/sot/architecture.md`：补充 `web/main.js` 对编辑态（暂停）输入处理与状态机说明（高层即可）

## 5. 完成后归档动作（固定）
实现完成并完成基本自测后：
1) 输出交付摘要并请求用户验收
2) 用户验收通过后，按第 4 节更新 SOT
3) 更新第 6 节检查单（必须全勾）
4) 将整个目录从 `docs/wip/20260110-grid-reset-editor/` 移动到 `docs/archive/20260110-grid-reset-editor/`

## 6. WIP 检查单（必须全勾才能归档）
- [x] plan.md 已确认（PLAN 闸门已通过）
- [x] 代码改动已完成（IMPLEMENT 完成）
- [x] 基本自测已完成（用户手动验收：Reset 白板 + 暂停编辑）
- [x] 已输出交付摘要并且用户验收通过（VERIFY 闸门已通过）
- [x] SOT 已更新（按第 4 节执行）：`docs/sot/overview.md`、`docs/sot/architecture.md`
- [x] 已归档：wip → archive（目录已移动）
