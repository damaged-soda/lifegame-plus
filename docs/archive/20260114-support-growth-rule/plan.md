# 支撑生长规则（需要下/左下/右下支撑）技术变更计划（Plan）

## 0. 背景与目标（简短即可）
- 背景：当前“方向规则”里已有基于某些相邻方向触发的出生规则，希望新增一种更具结构性的“支撑生长”规则：只有底部、左下、右下都有格子，才能在其上方长出一格。
- 目标：
  - 新增一条可选的“出生（空 → 活）”方向规则：当 **下 / 左下 / 右下** 均为活时，中心空格出生
  - 保持现有方向规则语义与 UI 交互约束不变（播放中禁用面板，暂停可调整）
- 非目标：
  - 不新增棋盘编辑能力
  - 不修改引擎的方向规则匹配/概率语义（仅新增一条预设规则卡片）

约定（已由用户确认）：
1) 这是“出生（空→活）”规则：下/左下/右下都为活则出生。
2) 支撑按“同类型支撑”：A 只看 A 的下/左下/右下；B/C 同理（沿用现有“各类型只看同类型邻居”）。
3) 默认不启用：加入现有规则集“扩展”，`enabledByDefault=false`，需要用户在 UI 勾选启用。

## 1. 影响范围（必须）
- 影响的 repo（来自 docmap，可多项）：`lifegame-plus`
- 影响的模块/目录/文件（按 repo 分组列出即可）：
  - `src/lifegame-plus/web/main.js`（在 `RULE_SETS` 中新增 1 条 birth rule 定义）
- 外部可见变化（如适用：API/CLI/配置/数据格式）：
  - 规则面板“出生（空→活）”下新增 1 张规则卡片：`支撑生长（需要下/左下/右下）`

## 2. 方案与改动点（必须）
说明：实现将按批次推进；每批次写入前需先列出本批次改动文件/影响并征求确认。

- repo: lifegame-plus
  - 改动点：
    - Web：在预设规则集 `expand` 的 `birthRules` 中增加“支撑生长”规则
  - 新增/修改的接口或数据结构：无
  - 关键逻辑说明：
    - 该规则对应方向掩码：`下(S) + 左下(SW) + 右下(SE)` 同时为活才触发出生
    - 引擎无需改动：UI 侧生成 `mustAliveMask = S|SW|SE` 的 birth rule 即可

## 3. 自测与验收口径（必须，可执行）
- 本地自测步骤（命令/操作）：
  - `python3 -m http.server 8000`
  - 打开 `http://127.0.0.1:8000/src/lifegame-plus/web/`
  - 暂停态，在规则面板启用“支撑生长”出生规则；点击播放观察
- 关键用例清单：
  - 默认关闭时：行为与当前一致（不影响现有规则）
  - 启用后：只有当某格的下/左下/右下（同类型）都为活时，该格才会出生
  - 与已有出生规则并存：仍保持“命中多条出生规则逐条抽样”的语义（本规则默认 p=100%）
- 通过标准：
  - UI 能看到并可启用/禁用该规则卡片
  - 启用后满足“需要三点支撑才生长”的判定
  - 默认关闭不引入行为变化

交付摘要口径（固定）：实现完成后，必须输出交付摘要，包含：
- 实际改动清单（按 repo 列出关键文件/模块）
- 自测步骤与结果
- 对照本节“通过标准”的逐条结论
- 已知风险/未决事项（如有必须列出）

约束：用户验收通过前，不更新 SOT，不归档 WIP。

## 4. SOT 更新清单（必须）
用户验收通过后，要把“最终事实”沉淀到 SOT（至少文件级，V1 不要求精确到小节）：

- `docs/sot/overview.md`：补充“方向规则”新增了可选出生规则“支撑生长（需要下/左下/右下）”
- `docs/sot/architecture.md`：一般无需更新（方向规则数据结构不变）；若 SOT 需要记录预设规则集内容，则补充该条规则

## 5. 完成后归档动作（固定）
实现完成并完成基本自测后：
1) 输出交付摘要并请求用户验收
2) 用户验收通过后，按第 4 节更新 SOT
3) 更新第 6 节检查单（必须全勾）
4) 将整个目录从 `docs/wip/20260114-support-growth-rule/` 移动到 `docs/archive/20260114-support-growth-rule/`

## 6. WIP 检查单（必须全勾才能归档）
- [x] plan.md 已确认（PLAN 闸门已通过）
- [x] 代码改动已完成（IMPLEMENT 完成）
- [x] 基本自测已完成：`node --check src/lifegame-plus/web/main.js`；引擎侧构造支撑场景断言出生逻辑
- [x] 已输出交付摘要并且用户验收通过（VERIFY 闸门已通过）
- [x] SOT 已更新：`docs/sot/overview.md`
- [x] 已归档：wip → archive（目录已移动）
